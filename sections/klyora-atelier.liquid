{% schema %}
{
  "name": "Klyora Atelier",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "KLYORA"
    }
  ],
  "presets": [
    {
      "name": "Klyora Atelier"
    }
  ]
}
{% endschema %}

{% if collections.all.products.size == 0 %}
  <div style="background: #000; color: #fff; padding: 40px; text-align: center; border: 1px solid #333; margin: 20px;">
    <h3 style="font-family: sans-serif; text-transform: uppercase; letter-spacing: 2px;">No Active Products Found</h3>
    <p style="font-family: sans-serif; color: #888; margin-top: 10px;">Please ensure your products are set to "Active" status in the Shopify Admin.</p>
    <p style="font-size: 10px; color: #555; margin-top: 5px;">Debug: Collection 'all' size is 0.</p>
  </div>
{% endif %}
<div id="root"></div>

<script>
  window.KlyoraConfig = {
    shop: "{{ shop.permanent_domain }}",
    products: [
      {% for product in collections.all.products limit: 12 %}
        {
          id: "{{ product.id }}",
          name: "{{ product.title | escape }}",
          price: {{ product.price | divided_by: 100.0 }},
          image: "{{ product.featured_image | img_url: '1024x' }}",
          category: "{{ product.type }}",
          description: "{{ product.description | strip_html | escape | truncate: 150 }}",
          variants: [
            {% for variant in product.variants %}
              {
                id: "{{ variant.id }}",
                title: "{{ variant.title | escape }}",
                price: {{ variant.price | divided_by: 100.0 }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  };
</script>

<script src="{{ 'klyora.js' | asset_url }}" defer="defer"></script>
