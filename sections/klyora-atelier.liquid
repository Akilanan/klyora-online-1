{% schema %}
{
  "name": "Klyora Atelier",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "KLYORA"
    }
  ],
  "presets": [
    {
      "name": "Klyora Atelier"
    }
  ]
}
{% endschema %}

<div id="root"></div>

<script>
  window.KlyoraConfig = {
    shop: {{ shop.permanent_domain | json }},
    currency: {{ cart.currency.symbol | json }},
    customer: {% if customer %}
      {
        id: {{ customer.id | json }},
        name: {{ customer.name | json }},
        totalSpent: {{ customer.total_spent | divided_by: 100.0 | json }},
        ordersCount: {{ customer.orders_count | json }},
        tags: {{ customer.tags | json }}
      }
    {% else %}
      null
    {% endif %},
    products: [
      {% for product in collections.all.products limit: 12 %}
        {
          id: {{ product.id | json }},
          name: {{ product.title | json }},
          price: {{ product.price | divided_by: 100.0 | json }},
          image: {{ product.featured_image | img_url: '1024x' | json }},
          category: {{ product.type | json }},
          description: {{ product.description | strip_html | truncate: 150 | json }},
          descriptionHtml: {{ product.description | json }},
          images: [
            {% for image in product.images %}
              {{ image | img_url: '1024x' | json }}{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ],
          variants: [
            {% for variant in product.variants %}
              {
                id: {{ variant.id | json }},
                title: {{ variant.title | json }},
                price: {{ variant.price | divided_by: 100.0 | json }},
                available: {{ variant.available | json }}
              }{% unless forloop.last %},{% endunless %}
            {% endfor %}
          ]
        }{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  };
</script>

<script src="{{ 'klyora.js' | asset_url }}" defer="defer"></script>
